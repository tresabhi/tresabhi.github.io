---
import sharp from "sharp";
import { hashContent } from "../core/hashContent";
import { sourceSet } from "../core/sourceSet";

interface Props {
  src: string;
  alt: string;
}

const { alt, ...props } = Astro.props;

const response = await fetch(props.src);
const buffer = await response.arrayBuffer();
const image = sharp(buffer);
const name = await hashContent(buffer);
const { src, srcset, metadata } = await sourceSet(image, name);
---

<img
  {src}
  {srcset}
  {alt}
  width={metadata.width}
  height={metadata.height}
  class="responsive-image"
  loading="lazy"
  decoding="async"
  fetchpriority="auto"
/>
